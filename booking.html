<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-MS3QJRDZ7C"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-MS3QJRDZ7C');
</script>
  <link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="#4a148c">
<meta name="google-adsense-account" content="ca-pub-9442859388560602">

  <meta charset="UTF-8">
  <title>Kanha Library Seat Booking</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Poppins', sans-serif; }
    body {
      background: linear-gradient(135deg, #b2ebf2, #f3e5f5);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 10px;
    }

    .main-wrapper {
      display: flex;
      flex-direction: row;
      gap: 20px;
      justify-content: center;
      align-items: flex-start;
      flex-wrap: wrap;
      width: 100%;
      max-width: 800px;
    }

    .container, .legend {
      background: white;
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.1);
    }

    .container {
      flex: 1 1 320px;
      max-width: 380px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    h1 {
      text-align: center;
      font-size: 1.5rem;
      color: #6a1b9a;
    }

    label { font-weight: 600; font-size: 0.9rem; margin-bottom: 3px; }

    select, input[type="date"] {
      width: 100%;
      padding: 8px 10px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 0.95rem;
    }

    .seat-map {
      display: grid;
      grid-template-columns: repeat(8, 1fr);
      gap: 6px;
      margin-top: 5px;
    }

    .seat {
      width: 30px; height: 30px;
      border-radius: 6px;
      line-height: 30px;
      text-align: center;
      font-weight: bold;
      cursor: pointer;
      font-size: 0.85rem;
    }

    .available { background: white; border: 1px solid #ccc; }
    .booked { background: #e53935; color: white; }
    .half-booked { background: #ffa726; color: white; }
    .evening-booked { background: #8e24aa; color: white; }
    .selected { border: 2px solid #2196f3; }

    .amount-display {
      font-size: 1.1rem;
      color: #2e7d32;
      text-align: center;
      margin: 5px 0;
    }

    .radio-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .radio-group label {
      display: flex;
      align-items: center;
      gap: 8px;
      background: #f5f5f5;
      padding: 10px 12px;
      border-radius: 8px;
      font-size: 0.95rem;
    }

    .radio-group input[type="radio"] {
      accent-color: #7b1fa2;
      width: 16px;
      height: 16px;
    }

    button {
      width: 100%;
      padding: 12px;
      background: linear-gradient(to right, #7b1fa2, #ba68c8);
      border: none;
      border-radius: 10px;
      font-size: 1rem;
      font-weight: 600;
      color: white;
      margin-top: 10px;
      cursor: pointer;
    }

    .legend {
      flex: 0 0 200px;
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .legend h3 {
      font-size: 1.2rem;
      color: #333;
      text-align: center;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 0.95rem;
    }

    .color-box {
      width: 20px;
      height: 20px;
      border-radius: 4px;
      border: 1px solid #ccc;


    }

    .seat.disabled {
  pointer-events: none;
  opacity: 0.5;
  cursor: not-allowed;
}


.price-breakdown {
  font-family: Arial, sans-serif;
  font-size: 15px;
  margin-top: 10px;
  border: 1px solid #ddd;
  padding: 12px;
  border-radius: 6px;
  background: #fafafa;
  max-width: 300px;
}

.price-breakdown div {
  display: flex;
  justify-content: space-between;
  margin: 6px 0;
}

.price-breakdown .discount {
  color: green;
  font-weight: bold;
}

.price-breakdown .total {
  font-size: 18px;
  font-weight: bold;
  color: #222;
}

.price-breakdown hr {
  margin: 10px 0;
  border: none;
  border-top: 1px solid #ccc;
}
.loader {
  margin: 10px auto;
  border: 6px solid #eee;
  border-top: 6px solid #3498db;
  border-radius: 50%;
  width: 30px;
  height: 30px;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

#payment-warning {
  display: none; /* Hidden by default */
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: rgba(255, 255, 255, 0.96);
  z-index: 9999;
  justify-content: center;
  align-items: center;
  flex-direction: column;
  padding: 20px;
  text-align: center;
}



  

    @media(max-width: 768px){
  .main-wrapper { flex-direction: column; align-items: center; }
}



  /* ===== Mobile bottom action bar ===== */
.mobile-action-bar {
  display: none; /* default hidden on desktop */
  position: fixed;
  left: 0;
  right: 0;
  bottom: 0;
  height: 72px;
  padding: 10px;
  background: linear-gradient(90deg, #ffffff, #fafafa);
  box-shadow: 0 -8px 30px rgba(0,0,0,0.08);
  border-top: 1px solid rgba(0,0,0,0.06);
  z-index: 9999;
  display: flex;
  gap: 12px;
  align-items: center;
  justify-content: space-between;
  padding-left: 14px;
  padding-right: 14px;
}

/* amount box */
.mobile-amount {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  white-space: nowrap;   /* prevent newline between ₹ and number */
  font-weight: 700;
  color: #222;
  font-size: 1rem;
  line-height: 1;
}

.mobile-amount .currency {
  font-size: 0.92rem;
  opacity: 0.95;
}
.mobile-amount .amount-num {
  font-size: 1.05rem;
  font-weight: 800;
}

/* mobile book button */
/* updated mobile book button — narrower, responsive, accessible */
.mobile-book-btn {
  flex: 0 0 auto;                     /* don't stretch */
  min-width: 96px;                    /* smaller minimum width */
  max-width: 220px;                   /* avoid growing too large on wide screens */
  padding: 10px 14px;                 /* slightly reduced padding */
  border-radius: 10px;
  background: linear-gradient(90deg, #7b1fa2, #ba68c8);
  color: #fff;
  border: none;
  font-weight: 700;
  font-size: 0.96rem;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  box-shadow: 0 8px 20px rgba(123,31,162,0.12);
  transition: transform .12s ease, box-shadow .12s ease, opacity .12s;
  cursor: pointer;
  -webkit-tap-highlight-color: transparent;
}

/* hover / lift effect */
.mobile-book-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 12px 28px rgba(123,31,162,0.18);
}

/* active / pressed */
.mobile-book-btn:active {
  transform: translateY(0);
  box-shadow: 0 6px 12px rgba(123,31,162,0.10);
}

/* keyboard focus styling for accessibility */
.mobile-book-btn:focus {
  outline: 3px solid rgba(123,31,162,0.14);
  outline-offset: 2px;
}

/* very small screens: allow button to grow and share space with amount */
@media (max-width: 360px) {
  .mobile-book-btn {
    flex: 1 1 auto;   /* allow button to take remaining space */
    min-width: 0;
    padding: 10px 12px;
    font-size: 0.94rem;
  }
  .mobile-amount {
    margin-right: 8px; /* small breathing room */
  }
}

/* slightly smaller adjustments for narrow phones */
@media (max-width: 420px) {
  .mobile-book-btn { min-width: 90px; padding: 10px 12px; font-size: 0.94rem; }
}

/* make CTA full-width when smaller screens */
@media (max-width: 420px) {
  .mobile-action-bar { height: 78px; gap: 10px; padding-left: 12px; padding-right: 12px; }
  .mobile-amount { font-size: 0.95rem; }
  .mobile-book-btn { min-width: 120px; padding: 12px; font-size: 0.95rem; }
}

/* show the bar and add bottom spacing only on small screens */
@media (max-width: 768px) {
  .mobile-action-bar { display: flex; }
  /* ensure page content isn't hidden behind the bar */
  body, .main-wrapper { padding-bottom: 100px; }
}

/* optional: hide desktop CTA if you had another big Book button visible */
@media (min-width: 769px) {
  .mobile-action-bar { display: none; }
}
  @media (max-width: 768px) {
  #book-btn { display: none; }
}

  </style>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9442859388560602"
     crossorigin="anonymous"></script>
</head>

<script>
  const userData = localStorage.getItem("user");
  if (!userData) {
    alert("Please log in to access the booking page.");
    window.location.href = "login.html";
  }
</script>
<script src="https://mercury.phonepe.com/web/bundle/checkout.js" defer></script>



<body>
  
  <div class="main-wrapper">
    <div class="container">
      <h1>Library Seat Booking</h1>

      <div><label>Start Date:</label><input type="date" id="start-date"></div>

      <div><label>Duration:</label>
        <select id="duration">
          <option value="1">1 Month</option><option value="2">2 Months</option><option value="3">3 Months</option>
          <option value="4">4 Months</option><option value="5">5 Months</option><option value="6">6 Months</option>
          <option value="7">7 Months</option><option value="8">8 Months</option><option value="9">9 Months</option>
          <option value="10">10 Months</option><option value="11">11 Months</option><option value="12">12 Months</option>
        </select>
      </div>

      <div><label>Shift:</label>
        <select id="shift">
          <option value="am">Morning</option><option value="pm">Evening</option><option value="full">Full Day</option>
        </select>
      </div>
      <div class="radio-group">
        <label><input type="radio" name="paymentMode" value="online" checked> Pay Online</label>
        <label><input type="radio" name="paymentMode" value="cash"> Pay Cash at Library</label>
      </div>

      <div class="seat-map" id="seat-map"></div>

      <div class="amount-display">Total Amount: <span id="amount-display">₹ 0</span></div>

      
      

      <button id="book-btn">Book Seat</button>

      
    </div>
    <div id="payment-warning">
  <div class="loader"></div>
  <p style="margin-top: 20px; font-weight: bold; color: red;">
    ⚠️ Please do not press back or refresh during payment.<br>
    Your seat will be confirmed after successful payment.
  </p>
</div>


      

    <div class="legend">
      <h3>Legend</h3>
      <div class="legend-item"><div class="color-box" style="background:white;"></div> Available</div>
      <div class="legend-item"><div class="color-box" style="background:#e53935"></div> Fully Booked</div>
      <div class="legend-item"><div class="color-box" style="background:#ffa726"></div> Morning Booked</div>
      <div class="legend-item"><div class="color-box" style="background:#8e24aa"></div> Evening Booked</div>
    </div>
  </div>

  <script src="booking.js?v=1.3.6"></script>
  <!-- Mobile action bar (visible only on small screens) -->
<div class="mobile-action-bar">
  <div class="mobile-amount">Total: <span id="mobile-amount"><span class="currency">₹</span><span class="amount-num">0</span></span></div>
  <button id="mobile-book-btn" class="mobile-book-btn">Book Now</button>
</div>


<script>
(function(){
  const API_PRICES = 'https://kanha-backend-yfx1.onrender.com/api/prices';
  const mobileAmountEl = document.getElementById('mobile-amount');
  const shiftEl = document.getElementById('shift');
  const durationEl = document.getElementById('duration');
  const bookBtn = document.getElementById('book-btn');

  if (!mobileAmountEl) {
    console.warn('mobile-amount element not found. Script will not run.');
    return;
  }

  // Try to reuse already-fetched priceSettings if present (common in booking.js)
  let _prices = window.priceSettings || window._priceSettings || null;

  async function fetchPricesIfNeeded() {
    if (_prices) return _prices;
    try {
      const res = await fetch(API_PRICES);
      if (!res.ok) throw new Error('fetch failed');
      _prices = await res.json();
      // also expose globally for reuse
      window._priceSettings = _prices;
      return _prices;
    } catch (e) {
      console.warn('Could not fetch prices, using fallback defaults.', e);
      _prices = { am: 500, pm: 400, full: 900, paymentGatewayFeePercent: 2.5, convenienceFee: 25, offers: [] };
      window._priceSettings = _prices;
      return _prices;
    }
  }

  function getDiscountForDuration(offers, months) {
    if (!Array.isArray(offers)) return 0;
    let best = 0;
    for (const o of offers) {
      const dur = Number(o.duration || 0);
      const disc = Number(o.discount || 0);
      if (months >= dur && disc > best) best = disc;
    }
    return best;
  }

  function computeTotal(basePrice, months, discount, pgPercent, convenience) {
    const baseTimesMonths = Number(basePrice) * Number(months);
    const subtotal = baseTimesMonths - Number(discount || 0);
    const pgFee = Math.round(((subtotal + Number(convenience || 0)) * Number(pgPercent || 0)) / 100);
    const total = subtotal + pgFee + Number(convenience || 0);
    return { subtotal, pgFee, convenience, total };
  }

  function formatINRWithSpace(n) {
    if (isNaN(n)) return '₹ 0';
    // simple thousands separator
    return '₹ ' + n.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
  }

  async function updateMobileAmount() {
    const prices = await fetchPricesIfNeeded();
    const shift = (shiftEl && shiftEl.value) || 'am';
    const months = parseInt((durationEl && durationEl.value) || '1', 10) || 1;

    // try to use user customPricing if available
    let basePrice;
    try {
      const user = JSON.parse(localStorage.getItem('user') || 'null');
      if (user && user.customPricing && user.customPricing[shift]) {
        basePrice = Number(user.customPricing[shift]);
      }
    } catch (e) { /* ignore */ }

    if (!basePrice) {
      basePrice = (shift === 'full') ? (prices.full || 0) : (prices[shift] || 0);
    }

    const discount = getDiscountForDuration(prices.offers || [], months);

    const paymentMode = (document.querySelector('input[name="paymentMode"]:checked') || {}).value || 'online';
    const pgPercent = (paymentMode === 'cash') ? 0 : (prices.paymentGatewayFeePercent || 0);
    const convenience = (paymentMode === 'cash') ? 100 : (prices.convenienceFee || 0);

    const { total } = computeTotal(basePrice, months, discount, pgPercent, convenience);

    // update the mobile amount span
   // update the mobile amount using the centralized helper (keeps currency + numeric spans)
updateMobileBarAmount(total);


    // also update book button dataset so booking.js (if it reads it) can use it
    if (bookBtn) bookBtn.dataset.amount = total;

    return total;
  }

  // attach listeners
  if (durationEl) durationEl.addEventListener('change', updateMobileAmount);
  if (shiftEl) shiftEl.addEventListener('change', updateMobileAmount);
  document.querySelectorAll('input[name="paymentMode"]').forEach(r => r.addEventListener('change', updateMobileAmount));

  // run on load (small delay to let other scripts finish)
  window.addEventListener('load', () => { setTimeout(updateMobileAmount, 150); });

  // expose for manual calls
  window.__Kanha_updateMobileAmount = updateMobileAmount;
})();
function updateMobileBarAmount(numericAmount) {
  const mobileAmountEl = document.getElementById('mobile-amount');
  if (!mobileAmountEl) return;
  // if using structured HTML (currency + amount)
  const amountNum = mobileAmountEl.querySelector('.amount-num');
  if (amountNum) {
    amountNum.textContent = new Intl.NumberFormat('en-IN', { maximumFractionDigits:0 }).format(numericAmount ? numericAmount : 0);
    // ensure currency symbol exists
    if (!mobileAmountEl.querySelector('.currency')) {
      mobileAmountEl.insertAdjacentHTML('afterbegin', '<span class="currency">₹</span>');
    }
  } else {
    // fallback: plain text
    mobileAmountEl.textContent = '₹ ' + (numericAmount ? numericAmount : 0);
  }
}

</script>
<script>
  document.getElementById("mobile-book-btn")
    .addEventListener("click", () => {
      document.getElementById("book-btn").click();
    });
</script>


</body>
</html>
