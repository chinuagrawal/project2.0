<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="icon" href="images/fevicon/favicon.ico" type="image/x-icon">

  <!-- PNG favicons -->
  <link rel="icon" type="image/png" sizes="16x16" href="images/fevicon/favicon-16x16.png">
  <link rel="icon" type="image/png" sizes="32x32" href="images/fevicon/favicon-32x32.png">

  <!-- Android Chrome -->
  <link rel="icon" type="image/png" sizes="192x192" href="images/fevicon/android-chrome-192x192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="images/fevicon/android-chrome-512x512.png">

  <!-- Apple Touch Icon -->
  <link rel="apple-touch-icon" sizes="180x180" href="images/fevicon/apple-touch-icon.png">

  <!-- Manifest for PWA -->
  <link rel="manifest" href="images/fevicon/site.webmanifest">
  <link rel="manifest" href="/manifest.json">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="0" />

<meta name="theme-color" content="#4a148c">

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kanha Library Seat Booking - best library in kota</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="./index.css?v=1.3.4">
  <link rel="stylesheet" href="./css/testimonials.css">
  
  

  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-MS3QJRDZ7C"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-MS3QJRDZ7C');
</script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9442859388560602"
     crossorigin="anonymous"></script>
</head>
<body>
  <!-- SIMPLE OFFERS POPUP (paste right after <header>) -->
<style>
  /* minimal responsive modal */
  #offers-modal { position: fixed; inset: 0; display: none; align-items: center; justify-content: center; z-index: 9999; }
  #offers-modal .overlay { position:absolute; inset:0; background: rgba(0,0,0,0.45); }
  #offers-modal .card {
    position: relative;
    z-index: 2;
    width: 92%;
    max-width: 720px;
    background: #fff;
    border-radius: 10px;
    padding: 18px;
    box-shadow: 0 14px 35px rgba(0,0,0,0.22);
    font-family: "Poppins", system-ui, Arial;
    color: #222;
  }
  #offers-modal h3 { margin: 0 0 8px 0; font-size: 1.2rem; }
  .offers-text { margin-top: 10px; line-height: 1.45; color:#444; }
  .offers-item { margin: 10px 0; padding: 8px 10px; border-radius:6px; background: #f7f7f7; }
  .close-offers { position:absolute; right:12px; top:12px; background:#ef5350; color:#fff; border:none; padding:6px 8px; border-radius:6px; cursor:pointer; }
  @media (max-width:460px){
    #offers-modal .card { padding:14px; border-radius:8px; }
    #offers-modal h3 { font-size:1.05rem; }
  }
</style>

<div id="offers-modal" role="dialog" aria-modal="true" aria-label="Current offers">
  <div class="overlay" onclick="document.getElementById('offers-modal').style.display='none'"></div>
  <div class="card">
    <button class="close-offers" id="closeOffersBtn" aria-label="Close offers">‚úï</button>

    <h3>üî•Offers ‚Äî Kanha Library</h3>
    <div class="offers-text">
      <div class="offers-item"><strong>Book 2 months ‚Üí Get 70‚Çπ discount</strong><div style="font-size:0.95rem; color:#555;">Purchase minimum 2 months of any shift and Get discount of 70rs.</div></div>
      <div class="offers-item"><strong>Book 3 months ‚Üí Get 150‚Çπ discount</strong><div style="font-size:0.95rem; color:#555;">Purchase minimum 3 months of any shift and Get discount of 150rs.</div></div>
      <div class="offers-item"><strong>Book 6 months ‚Üí Get 450‚Çπ discount</strong><div style="font-size:0.95rem; color:#555;">Purchase minimum 6 months of any shift and Get discount of 450rs.</div></div>
      <div class="offers-item"><strong>Referral ‚Äî ‚Çπ100 OFF for both</strong><div style="font-size:0.95rem; color:#555;">Invite your freind to our library. When they book, both of you get ‚Çπ100 off.</div></div>

 
      <div style="margin-top:10px; font-size:0.95rem; color:#666;">
        <em>Note:</em> For details or to use an offer, visit the booking page or contact us at +91 8870969514 on Whatsapp.
      </div>
    </div>
  </div>
</div>

<script>
  // show modal once per session (remove sessionStorage check if you want it every load)
  document.addEventListener('DOMContentLoaded', () => {
    if (!sessionStorage.getItem('offersSeen')) {
      document.getElementById('offers-modal').style.display = 'flex';
      sessionStorage.setItem('offersSeen','1');
    }
    document.getElementById('closeOffersBtn').addEventListener('click', () => {
      document.getElementById('offers-modal').style.display = 'none';
    });
  });
</script>


  <header>
    <div class="logo-title">
    <img src="images/logo.jpg" alt="Kanha Library Logo" class="logo">
    <h2>Kanha Library</h2>
    </div>
    <nav>
      <span id="user-section">
      <a href="./login.html" id="login-link">Login</a>
      </span>
      <a href="#home">Home</a>
      <a href="#about">About</a>
      <a href="./booking.html">Book Now</a>
      <a href="#contact">Contact</a>
      <a href="./policies.html">Policies</a>
      <a href="./admin.html">Admin</a>

      
    </nav>
  </header>

  <span class="credit-text">Website made by Chinmay Agrawal | contact no. 7976769514</span>
  <h3 id="welcome-message" class="welcome-text"></h3>
<section id="my-bookings" style="display:none; padding: 20px;">
      <h2>üìö My Booked Seats</h2>
      <div id="booking-list" class="booking-list"></div>
    </section>

<!-- Carousel root: add role/aria for accessibility -->
<div class="carousel" id="mainCarousel" role="region" aria-roledescription="carousel" aria-label="Library images carousel">
  <div class="carousel-track">
    <div class="carousel-slide"><img src="images/3.jpg" alt="Seating layout" ></div>
    <div class="carousel-slide"><img src="images/9.jpg" alt="Reviews" ></div>
    <div class="carousel-slide"><img src="images/4.jpg" alt="Study desks" ></div>
    <div class="carousel-slide"><img src="images/10.jpg" alt="Reviews" ></div>
    <div class="carousel-slide"><img src="images/1.jpg" alt="Study desks" ></div>
    <div class="carousel-slide"><img src="images/7.jpg" alt="Study desks" ></div>
    <!-- add more slides -->
  </div>

  <!-- Controls -->
  <button class="carousel-button prev" aria-label="Previous slide">&lt;</button>
  <button class="carousel-button next" aria-label="Next slide">&gt;</button>

  <!-- Indicators -->
  <div class="carousel-indicators" aria-hidden="false"></div>
</div>



    <section>
 
<div id="confirmation-modal" class="modal hidden">
  <div class="modal-content">
    
    <p id="confirmation-details"></p>
    <button id="close-modal">OK</button>
  </div>
</div>
    
  


    <h1>Welcome to Our Kanha Library</h1>
     <div style="margin-top: 40px; text-align: center;">
  <h2>üìÖ Check Seat Availability</h2>
  <h3>Select Date  üëá</h3>
  <input type="date" id="calendar-date" style="padding: 8px; font-size: 16px; margin-bottom: 15px;" />


  <div id="liveCounter" style="text-align:center; margin:20px; font-size:1.3rem; font-weight:bold; color:#f9e616;">
  üî• Hurry! Only <span id="seatsLeft">--</span> seats left today. Don‚Äôt miss out!
</div>

<script>
async function updateLiveCounter() {
  try {
    const today = new Date().toISOString().split("T")[0]; 
    const res = await fetch(`${API_BASE}/bookings?date=${today}`);
    const bookings = await res.json();

    const booked = Array.isArray(bookings) ? bookings.length : 0;
    const total = 34; // total seats
    const left = total - booked;

    // update DOM
    document.getElementById("seatsLeft").textContent = left;

    // urgency color coding
    const counter = document.getElementById("liveCounter");
    if (left <= 5) {
      counter.style.color = "red";
      counter.style.fontSize = "1.5rem";
    } else if (left <= 10) {
      counter.style.color = "orange";
    } else {
      counter.style.color = "#4caf50";
    }
  } catch (err) {
    console.error("‚ö†Ô∏è Failed to update live counter:", err);
  }
}

// run on page load
document.addEventListener("DOMContentLoaded", () => {
  updateLiveCounter();
  // refresh every 30 sec
  setInterval(updateLiveCounter, 30000);
});
</script>



   <div class="seat-layout-container">
        <div class="fans-top">
          <div class="fan-icon">üåÄ Fan</div>
          <div class="fan-icon">üåÄ Fan</div>
        </div>
        <div class="seat-layout">
          <br>
          <div class="row" id="row3"></div>
          <div class="row" id="row2"></div>
          <br>
          <div class="row" id="row1"></div>
        </div>
        <div class="fan-bottom">
          <div class="fan-icon">üåÄ Fan</div>
          <div class="fan-icon">üåÄ Fan</div>
          <div class="fan-icon">üåÄ Fan</div>
        </div>
      </div>
  <div class="legend-container">
  <div class="legend-item legend-full-booked">Fully Booked</div>
  <div class="legend-item legend-am-booked">AM Booked</div>
  <div class="legend-item legend-pm-booked">PM Booked</div>
  <div class="legend-item legend-available">Available</div>
</div>

    <button class="book-now-btn" type="button">Book Now</button>
<br><br>
    <button id="installBtn" style="display: none;" class="install-app-btn">
  <img src="icon-192.png" alt="App Icon" class="install-icon">
  Download KanhaLibrary App
</button>

</section>

<!--
  <section>
    <iframe src='https://widgets.sociablekit.com/google-reviews/iframe/25586921' frameborder='0' width='100%' height='400'></iframe>
  </section>
  -->
  
  <!-- TESTIMONIAL -->
  
  <section class="testimonial-container" id="testimonials">
    <h2 class="section-title">What Our Clients Say</h2>
    <div class="slider-wrapper">
      <div class="testimonial-slider">
        <div class="testimonial-card">
          <img src="./images/reviews/1.png" alt="Client Photo" class="testimonial-image">
          <p class="testimonial-quote">"Best library in kota for study and very silent library in kota. Best wifi connection,air conditioned room, water facility is also available. Best motivation frames to get motivate for our preparation and on every desk two charging ports and a led light is attached with wider desk area"</p>
          <h3 class="testimonial-name">Aditya Jaat</h3>
          <div class="testimonial-rating">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
        </div>
        
        
        <div class="testimonial-card">
          <img src="./images/reviews/2.png" alt="Client Photo" class="testimonial-image">
          <p class="testimonial-quote">"A Perfect Place for Learning and Peace! .I absolutely love this library! It‚Äôs a quiet, well-organized, and resourceful place that truly supports learning and personal growth.The seating is comfortable, the environment is peaceful, and there‚Äôs just something motivating about being surrounded by knowledge.Highly recommended üìö‚ú®"</p>
          <h3 class="testimonial-name">Riyanshi Rajawat</h3>
          <div class="testimonial-rating">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
        </div>
        <div class="testimonial-card">
          <img src="./images/reviews/3.png" alt="Client Photo" class="testimonial-image">
          <p class="testimonial-quote">"Best library I have ever been to , Pride of Kota."</p>
          <h3 class="testimonial-name">Ashish Raj</h3>
          <div class="testimonial-rating">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
        </div>
        <div class="testimonial-card">
          <img src="./images/reviews/4.png" alt="Client Photo" class="testimonial-image">
          <p class="testimonial-quote">"Very Nice Experience. It's Study environment helps me a lot. It's easy to concentrate. And the owner's nature is also very good üëçüëç. "</p>
          <h3 class="testimonial-name">Kunal Mehra</h3>
          <div class="testimonial-rating">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
        </div>
        <div class="testimonial-card">
          <img src="./images/reviews/5.png" alt="Client Photo" class="testimonial-image">
          <p class="testimonial-quote">"A great place for study and good ambience, I should say good lighting and no interruptions and noise helped my concentration."</p>
          <h3 class="testimonial-name">Mahesh Soni</h3>
          <div class="testimonial-rating">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
        </div>
        
        
      </div>
    </div><br>
    <div class="review-widget_net" data-uuid="9f99bcf2-833b-446c-89d2-1dab467bc7d8" data-template="10" data-lang="en" data-theme="light"></div><script src="https://grwapi.net/widget.min.js"></script>
  </section>
  <!--
    <div id="map" style="display:none;"></div>
    
    <div id="google-reviews-container">
      <div id="google-reviews">Loading reviews...</div>
  <a id="write-review-btn" class="review-button" target="_blank">Write a Review</a>
</div>

<script>
let currentSlide = 0;
let totalSlides = 0;

function initMap() {
  const placeId = "ChIJNb-kHXubbzkR_7up04GFTDo";
  const service = new google.maps.places.PlacesService(document.getElementById("map"));
  
  service.getDetails(
    {
      placeId: placeId,
      fields: ["name", "rating", "reviews", "url"]
    },
    (place, status) => {
      if (status === google.maps.places.PlacesServiceStatus.OK) {
        document.getElementById("write-review-btn").href = "https://g.page/r/Cf-7qdOBhUw6EAI/review";
        
        let html = `<h3>${place.name} <span>‚≠ê ${place.rating}</span></h3>`;
        
        html += `<div class="reviews-row" id="reviews-slider">`;
        
        const sortedReviews = place.reviews.sort((a, b) => b.time - a.time);
        
        sortedReviews.forEach(r => {
          html += `
            <div class="review">
              <strong>${r.author_name}</strong>
              <div class="review-stars">‚≠ê ${r.rating}</div>
              <div class="review-text">${r.text}</div>
            </div>
          `;
        });
        
        html += `</div>`;
        
        document.getElementById("google-reviews").innerHTML = html;

        totalSlides = Math.ceil(sortedReviews.length / 3);
        setInterval(slideReviews, 2000);
      } else {
        document.getElementById("google-reviews").innerHTML = "Unable to load reviews.";
      }
    }
  );
}

function slideReviews() {
  const slider = document.getElementById("reviews-slider");
  currentSlide = (currentSlide + 1) % totalSlides;
  slider.style.transform = `translateX(-${currentSlide * 100}%)`;
}
</script>

<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAD_Fjj7bQLrU0JU74Yab74oOBvKvztLqw&libraries=places&callback=initMap"></script>

-->
<section>


 <div class="owner-card">
   <div class="owner-image"></div>
   <div class="owner-info">
     <h3>Mr. Brij Kishor Agrawal</h3>
     <p>Founder & Owner of Kanha Library. With years of dedication and commitment, he has built a peaceful and student-friendly study environment in the heart of Kota.</p>
   </div>
 </div>

  <div class="son-card">
   <div class="son-image"></div>
   <div class="owner-info">
     <h3>Mr. Chinmay Agrawal</h3>
     <p> Carrying forward my father‚Äôs vision, I am proud to help manage Kanha Library, ensuring it remains a peaceful, inspiring space for students and readers. With a blend of tradition and modern ideas, I‚Äôm working to make it the best library in Kota for focused learning and growth..</p>
   </div>
 </div>
</section>

  
  <section id="about">
  <p>
  <h3>üïí Library Timings & Charges</h3>
  <ul style="list-style: none; padding-left: 0; font-size: 1.1rem;">
    <li><strong>Morning Shift:</strong> 7:00 AM - 2:00 PM ‚Äî <span style="color: #cec002;">‚Çπ600</span></li>
    <li><strong>Evening Shift:</strong> 2:00 PM - 10:00 PM ‚Äî <span style="color: #cec002;">‚Çπ600</span></li>
    <li><strong>Full Day:</strong> 7:00 AM - 10:00 PM ‚Äî <span style="color: #cec002;">‚Çπ800</span></li>
  </ul>
  </p>
<br>
  <h2>About Us</h2>
  <p>We offer a peaceful self-study library environment with 34 seats available. Perfect for students, exam preparation, or quiet work.</p>
  <p>We aim to provide a peaceful and accessible study environment for all students and self-learners. With simple seat booking, secure online payments, and instant confirmations, your library experience is now smoother than ever.</p>
</section>
<section id="contact" style="padding: 3rem; background: linear-gradient(to right, #f5f7fa, #c3cfe2); border-radius: 20px; max-width: 1000px; margin: auto; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);">
  <h2 style="text-align: center; font-size: 2rem; color: #333; margin-bottom: 2rem;">üìû Contact Us</h2>

  <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 1.5rem;">
    <img src="https://img.icons8.com/ios-filled/30/000000/phone.png" alt="Phone Icon" style="width: 24px;">
    <a href="tel:+917976769514" style="font-size: 1.1rem; color: #000; text-decoration: none;">+91 7976769514</a>
    <a href="https://wa.me/917976769514" target="_blank">
      <img src="https://img.icons8.com/color/30/000000/whatsapp--v1.png" alt="WhatsApp Icon">
    </a>
  </div>

  <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 1.5rem;">
    <img src="https://img.icons8.com/ios-filled/30/000000/phone.png" alt="Phone Icon" style="width: 24px;">
    <a href="tel:+91" style="font-size: 1.1rem; color: #000; text-decoration: none;">+91</a>
    <a href="https://wa.me/91" target="_blank">
      <img src="https://img.icons8.com/color/30/000000/whatsapp--v1.png" alt="WhatsApp Icon">
    </a>
  </div>

  <div style="display: flex; align-items: center; gap: 10px;">
    <img src="https://img.icons8.com/ios-glyphs/30/000000/new-post.png" alt="Email Icon" style="width: 24px;">
    <a href="mailto:thechinmayagrawal@gmail.com" style="font-size: 1.1rem; color: #000; text-decoration: none;">thechinmayagrawal@gmail.com</a>
  </div>
</section>
<section style="text-align:center; padding: 20px;">
  <h3>üìç Our Location</h3>
  
  <div style="position: relative; width: 100%; max-width: 600px; margin: 0 auto; padding-top: 56.25%;">
    <iframe
      src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d907.5630559108914!2d75.88883464410213!3d25.17316652253965!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x396f9b7b1da4bf35%3A0x3a4c8581d3a9bbff!2sKanha%20Library!5e0!3m2!1sen!2sin!4v1752380422217!5m2!1sen!2sin"
      style="border:0; position: absolute; top: 0; left: 0; width: 100%; height: 100%;"
      allowfullscreen
      loading="eager"
      referrerpolicy="no-referrer-when-downgrade">
    </iframe>
  </div>
</section>
<script defer async src='https://cdn.trustindex.io/loader-cert.js?500a16b50c895583bc964b0462d'></script>

  <footer>
  <p>&copy; 2025 Kanha Library. All rights reserved.</p>
  <p style="font-size: 0.9rem; color: #aaa;">Website made by Chinmay Agrawal</p>
</footer>


  <script>
    if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('/sw.js')
    .then(() => console.log('‚úÖ Service Worker Registered'))
    .catch(err => console.error('Service Worker Failed:', err));
}

    const API_BASE = 'https://kanha-backend-yfx1.onrender.com/api';

    function formatDate(dateStr) {
      const date = new Date(dateStr);
      const day = String(date.getDate()).padStart(2, "0");
      const month = String(date.getMonth() + 1).padStart(2, "0");
      const year = date.getFullYear();
      return `${day}-${month}-${year}`;
    }

    function updateUserUI() {
      const userData = localStorage.getItem("user");
      const userSection = document.getElementById("user-section");
      if (userData) {
        const user = JSON.parse(userData);
        userSection.innerHTML = `<span>üë§ ${user.firstName || user.email} <button onclick="logout()">Logout</button></span>`;
      } else {
        userSection.innerHTML = `<a href="./login.html" id="login-link">Login</a>`;
      }
    }

    function logout() {
      localStorage.removeItem("user");
      updateUserUI();
      location.reload();
    }

    function groupBookings(bookings) {
      const groups = [];
      bookings.sort((a, b) => {
        if (a.seatId !== b.seatId) return a.seatId.localeCompare(b.seatId);
        if (a.shift !== b.shift) return a.shift.localeCompare(b.shift);
        return new Date(a.date) - new Date(b.date);
      });

      for (let i = 0; i < bookings.length; i++) {
        const current = bookings[i];
        const lastGroup = groups[groups.length - 1];
        const currentDate = new Date(current.date);
        const lastDate = lastGroup ? new Date(lastGroup.end) : null;

        if (
          lastGroup &&
          lastGroup.seatId === current.seatId &&
          lastGroup.shift === current.shift &&
          currentDate.getTime() === lastDate.getTime() + 86400000
        ) {
          lastGroup.end = current.date;
        } else {
          groups.push({
            seatId: current.seatId,
            shift: current.shift,
            start: current.date,
            end: current.date,
          });
        }
      }
      return groups;
    }

    async function loadBookings() {
      const userData = localStorage.getItem("user");
      if (!userData) return;
      const user = JSON.parse(userData);

      try {
        const res = await fetch(`${API_BASE}/bookings?email=${user.email}`);
        const bookings = await res.json();
        const section = document.getElementById("my-bookings");
        const list = document.getElementById("booking-list");

        if (Array.isArray(bookings) && bookings.length > 0) {
          section.style.display = "block";
          const grouped = groupBookings(bookings);
         
          list.innerHTML = grouped.map(b => {
  const today = new Date().toISOString().split('T')[0];
  const isExtendable = true;

  return `
    <div class="booking-card">
      <p><strong>Seat:</strong> ${b.seatId}</p>
      <p><strong>From:</strong> ${formatDate(b.start)}</p>
      <p><strong>To:</strong> ${formatDate(b.end)}</p>
      <p><strong>Shift:</strong> ${b.shift.toUpperCase()}</p>
      ${isExtendable ? `<button class="extend-btn" 
        data-seat="${b.seatId}" 
        data-shift="${b.shift}" 
        data-from="${b.start}" 
        data-to="${b.end}">Extend</button>` : ''}
    </div>
  `;
}).join('');
document.querySelectorAll(".extend-btn").forEach(btn => {
  btn.addEventListener("click", async (e) => {
    const seatId = e.target.dataset.seat;
    const shift = e.target.dataset.shift;
    const fromDate = e.target.dataset.from;
    const toDate = e.target.dataset.to;

    // Check extend availability
    try {
      const res = await fetch(`${API_BASE}/extend/check?seatId=${seatId}&shift=${shift}&fromDate=${fromDate}&toDate=${toDate}&email=${user.email}`);

      const data = await res.json();

      if (!data.canExtend) {
        alert("‚ö†Ô∏è Cannot extend: seat already booked for future dates.");
        return;
      }

      // Redirect to booking page with locked parameters
      window.location.href = `booking.html?extend=1&seatId=${seatId}&shift=${shift}&fromDate=${fromDate}&toDate=${toDate}`;
    } catch (err) {
      console.error("Failed to check extension availability:", err);
      alert("Server error while checking extend eligibility.");
    }
  });
});



        }
      } catch (err) {
        console.error("Error loading bookings:", err);
      }
    }

    function renderSeatLayout() {
  const rows = [
    { id: 'row1', count: 12 },
    { id: 'row2', count: 11 },
    { id: 'row3', count: 11 },
  ];

  let seatCounter = 1;

  rows.forEach(row => {
    const container = document.getElementById(row.id);
    if (!container) return;

    if (row.id === 'row2') {
      const leftAC = document.createElement('div');
      leftAC.className = 'ac-icon';
      leftAC.textContent = '‚ùÑÔ∏è AC';
      container.appendChild(leftAC);
    }

    for (let i = 0; i < row.count; i++) {
      const div = document.createElement('div');
      div.className = 'seat-box';
      div.textContent = `${seatCounter}`;
      container.appendChild(div);
      seatCounter++;
    }

    if (row.id === 'row2') {
      const rightAC = document.createElement('div');
      rightAC.className = 'ac-icon';
      rightAC.textContent = '‚ùÑÔ∏è AC';
      container.appendChild(rightAC);
    }
  });
}


   async function loadAvailability(date) {
  if (!date) return;
  const API_BASE = 'https://kanha-backend-yfx1.onrender.com/api';

  try {
    const response = await fetch(`${API_BASE}/bookings?date=${date}`);
    const bookings = await response.json();

    const seatStatus = {};
    bookings.forEach(b => {
      if (!seatStatus[b.seatId]) seatStatus[b.seatId] = [];
      seatStatus[b.seatId].push(b.shift.toUpperCase());
    });

    const seats = document.querySelectorAll('.seat-box');
    seats.forEach(seat => {
      const seatId = seat.textContent.trim();
      const shifts = seatStatus[seatId] || [];

      let bg = "white";
      if (shifts.includes("FULL") || (shifts.includes("AM") && shifts.includes("PM"))) {
        bg = "red";
      } else if (shifts.includes("PM") && !shifts.includes("AM")) {
        bg = "purple";
      } else if (shifts.length === 1) {
        bg = "orange";
      }

      seat.style.backgroundColor = bg;
      seat.style.color = (bg === "purple" || bg === "red") ? "white" : "black";
    });
  } catch (err) {
    console.error("Failed to load seat availability:", err);
  }
}


    document.addEventListener("DOMContentLoaded", () => {
      renderSeatLayout();
      // --- Safe carousel fallback (replace the old buggy snippet) ---
let currentIndex = 0;
const trackEl = document.querySelector('.carousel-track');
const slidesCount = trackEl ? trackEl.children.length : 0;

// Only run a simple autoplay if track exists and there are >1 slides
if (trackEl && slidesCount > 1) {
  const simpleInterval = setInterval(() => {
    currentIndex = (currentIndex + 1) % slidesCount;
    // use percent because slides are flex: 0 0 100%
    trackEl.style.transform = `translateX(-${currentIndex * 100}%)`;
  }, 4000);

  // Optional: stop when user focuses the track (avoid interfering with your main IIFE controls)
  trackEl.addEventListener('mouseenter', () => clearInterval(simpleInterval), { once: true });
}


      updateUserUI();
      loadBookings();


      // show confirmation or cash-submitted modal on page load if redirected with ?success=1
(function checkAndShowConfirmationOnLoad(){
  try {
    const params = new URLSearchParams(window.location.search);
    console.log('[index] checkAndShowConfirmationOnLoad params:', window.location.search);

    if (params.get('success') === '1') {
      const seatId = params.get('seatId') || '';
      const shift = params.get('shift') || '';
      const startDate = params.get('startDate') || '';
      const endDate = params.get('endDate') || '';
      const isCash = params.get('cash') === '1';

      console.log('[index] Redirect params:', { seatId, shift, startDate, endDate, isCash });

      if (isCash) {
        // Show cash-submitted modal (no confirmed booking)
        if (typeof showCashSubmittedModal === 'function') {
          showCashSubmittedModal(seatId, shift, startDate, endDate);
        } else {
          // fallback: reuse confirmation modal but change text
          showConfirmationModal(seatId, shift, startDate, endDate, { cashMode: true });
        }
      } else {
        // Show confirmed booking modal
        if (typeof showConfirmationModal === 'function') {
          showConfirmationModal(seatId, shift, startDate, endDate);
        } else {
          console.warn('showConfirmationModal not found on page');
        }
      }

      // remove query params without reloading (preserve pathname & hash)
      const cleanUrl = window.location.origin + window.location.pathname + window.location.hash;
      try {
        history.replaceState({}, document.title, cleanUrl);
      } catch (e) {
        console.warn('history.replaceState failed', e);
      }
    }
  } catch (err) {
    console.error('checkAndShowConfirmationOnLoad error', err);
  }
})();


      const bookNowBtn = document.querySelector(".book-now-btn");
      bookNowBtn.addEventListener("click", () => {
        const user = localStorage.getItem("user");
        if (!user) {
          alert("Please log in first.");
          window.location.href = "login.html";
        } else {
          window.location.href = "booking.html";
        }
      });

      const welcome = document.getElementById("welcome-message");
      const userData = localStorage.getItem("user");
      if (userData) {
        const user = JSON.parse(userData);
        welcome.textContent = `Welcome, ${user.firstName || ''} ${user.lastName || ''}`.trim();
      }

      const dateInput = document.getElementById("calendar-date");

// Set today's date in YYYY-MM-DD format
const today = new Date().toISOString().split("T")[0];
dateInput.value = today;

// Load today's availability immediately
loadAvailability(today);

// Listen for date change
dateInput.addEventListener("change", (e) => {
  // Show modal if redirected from booking page
const params = new URLSearchParams(window.location.search);
if (params.get('success') === '1') {
  const seatId = params.get('seatId');
  const shift = params.get('shift');
  const startDate = params.get('startDate');
  const endDate = params.get('endDate');
  showConfirmationModal(seatId, shift, startDate, endDate);
}

  const selectedDate = e.target.value;
  loadAvailability(selectedDate);
});

    });

  function showConfirmationModal(seatId, shift, startDate, endDate) {
  const modal = document.getElementById('confirmation-modal');
  const details = document.getElementById('confirmation-details');
  const closeBtn = document.getElementById('close-modal');

  details.innerHTML = `
  <h2>‚úÖ Booking Confirmed!</h2>
    Seat <strong>${seatId}</strong> booked for <strong>${shift}</strong> shift<br>
    From <strong>${startDate}</strong> to <strong>${endDate}</strong>.
  `;

  modal.classList.remove('hidden');

  closeBtn.onclick = () => {
    modal.classList.add('hidden');
    window.location.href = 'index.html'; // üîÅ Redirect and reload to show updated seat
  };
}
function showCashSubmittedModal(seatId = '', shift = '', startDate = '', endDate = '') {
  const modal = document.getElementById('confirmation-modal');
  const details = document.getElementById('confirmation-details');
  const closeBtn = document.getElementById('close-modal');

  details.innerHTML = `
    <h3>‚úÖ Request Submitted</h3>
    <p>Your cash booking request has been submitted and is pending confirmation from the library.</p>
    <p><strong>Seat:</strong> ${seatId || 'N/A'}<br>
       <strong>Shift:</strong> ${shift || 'N/A'}<br>
       <strong>From:</strong> ${startDate || 'N/A'}<br>
       <strong>To:</strong> ${endDate || 'N/A'}</p>
    
  `;

  modal.classList.remove('hidden');

  // just hide modal on close; no redirect (URL was already cleaned)
  closeBtn.onclick = () => {
    modal.classList.add('hidden');
    // optional: reload to reflect state: location.reload();
  };
}
  
  </script>
  <script>
  let deferredPrompt;

  window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault();
    deferredPrompt = e;
    const installBtn = document.getElementById('installBtn');
    installBtn.style.display = 'flex';

    installBtn.addEventListener('click', () => {
      deferredPrompt.prompt();
      deferredPrompt.userChoice.then(choiceResult => {
        if (choiceResult.outcome === 'accepted') {
          console.log('‚úÖ App installed');
        } else {
          console.log('‚ùå User dismissed');
        }
        installBtn.style.display = 'none';
      });
    });
  });
</script>




  </div>
</div>


<!-- Start of OpenWidget (www.openwidget.com) code -->
<script>
  window.__ow = window.__ow || {};
  window.__ow.organizationId = "19b7c8ac-511a-4b96-9aea-88d266dc2893";
  window.__ow.integration_name = "manual_settings";
  window.__ow.product_name = "openwidget";   
  ;(function(n,t,c){function i(n){return e._h?e._h.apply(null,n):e._q.push(n)}var e={_q:[],_h:null,_v:"2.0",on:function(){i(["on",c.call(arguments)])},once:function(){i(["once",c.call(arguments)])},off:function(){i(["off",c.call(arguments)])},get:function(){if(!e._h)throw new Error("[OpenWidget] You can't use getters before load.");return i(["get",c.call(arguments)])},call:function(){i(["call",c.call(arguments)])},init:function(){var n=t.createElement("script");n.async=!0,n.type="text/javascript",n.src="https://cdn.openwidget.com/openwidget.js",t.head.appendChild(n)}};!n.__ow.asyncInit&&e.init(),n.OpenWidget=n.OpenWidget||e}(window,document,[].slice))
</script>
<noscript>You need to <a href="https://www.openwidget.com/enable-javascript" rel="noopener nofollow">enable JavaScript</a> to use the communication tool powered by <a href="https://www.openwidget.com/" rel="noopener nofollow" target="_blank">OpenWidget</a></noscript>
<!-- End of OpenWidget code -->


<script>
/*
  Live counter for index.html
  - Uses your API endpoint: /api/bookings?date=YYYY-MM-DD
  - Counts a seat as "booked" if shift === 'full' OR both 'am' and 'pm' exist for same seat
  - Works with shift values like 'am','AM','pm','PM','full','FULL'
*/

(function () {
  // Use existing API_BASE if present, otherwise fallback
  const API = (typeof API_BASE !== 'undefined') ? API_BASE : 'https://kanha-backend-yfx1.onrender.com/api';
  const TOTAL_SEATS = 34;
  const POLL_MS = 30000; // refresh every 30s

  function normalizeShift(s) {
    if (!s) return '';
    return String(s).trim().toLowerCase();
  }

  async function fetchBookingsForDate(dateStr) {
    try {
      const res = await fetch(`${API}/bookings?date=${dateStr}`);
      if (!res.ok) {
        console.warn('LiveCounter: bookings fetch failed', res.status);
        return [];
      }
      const data = await res.json();
      return Array.isArray(data) ? data : [];
    } catch (err) {
      console.error('LiveCounter fetch error:', err);
      return [];
    }
  }

  function calcBookedSeats(bookings) {
    // build map: seatId -> Set of shifts
    const map = {};
    bookings.forEach(b => {
      const sid = String(b.seatId || b.seat || '').trim();
      if (!sid) return;
      const shift = normalizeShift(b.shift);

      let normalized;
      if (shift.includes('full')) normalized = 'full';
      else if (shift.startsWith('a')) normalized = 'am';
      else if (shift.startsWith('p')) normalized = 'pm';
      else normalized = shift; // fallback

      if (!map[sid]) map[sid] = new Set();
      map[sid].add(normalized);
    });

    // count seats that are fully blocked
    let bookedCount = 0;
    for (let i = 1; i <= TOTAL_SEATS; i++) {
      const sid = String(i);
      const s = map[sid];
      if (!s) continue;
      if (s.has('full') || (s.has('am') && s.has('pm'))) bookedCount++;
    }
    return bookedCount;
  }

  async function updateLiveCounter(dateStr) {
    try {
      const dateToUse = dateStr || (document.getElementById('calendar-date')?.value)
                        || new Date().toISOString().split('T')[0];
      if (!dateToUse) return;

      const bookings = await fetchBookingsForDate(dateToUse);
      const booked = calcBookedSeats(bookings);
      const left = Math.max(0, TOTAL_SEATS - booked);

      const counter = document.getElementById('liveCounter');
      if (!counter) return;

      const seatsLeftSpan = counter.querySelector('#seatsLeft');
      if (seatsLeftSpan) seatsLeftSpan.textContent = left;
      else counter.innerHTML = `üî• Hurry! Only <span id="seatsLeft">${left}</span> seats left today. Don‚Äôt miss out!`;

      // colours / emphasis
      if (left <= 3) {
        counter.style.color = 'yellow';
        counter.style.fontWeight = '600';
      } else if (left <= 8) {
        counter.style.color = 'yellow';
        counter.style.fontWeight = '600';
      } else {
        counter.style.color = 'Yellow'; // greenish
        counter.style.fontWeight = '600';
      }

      // optional: update console (useful while testing)
      // console.log(`[LiveCounter] ${dateToUse} ‚Äî booked ${booked}, left ${left}`);
    } catch (err) {
      console.error('updateLiveCounter error:', err);
    }
  }

  const carousel = document.getElementById('mainCarousel');
  const track = carousel.querySelector('.carousel-track');
  const slides = Array.from(track.children);
  const prevBtn = carousel.querySelector('.carousel-button.prev');
  const nextBtn = carousel.querySelector('.carousel-button.next');
  const indicatorsContainer = carousel.querySelector('.carousel-indicators');

  let index = 0;
  let autoplayInterval = 4000;
  let timer = null;
  let isPlaying = true;

  // build indicators
  slides.forEach((_, i) => {
    const btn = document.createElement('button');
    btn.type = 'button';
    btn.setAttribute('aria-label', `Go to slide ${i+1}`);
    if (i === 0) btn.setAttribute('aria-current','true');
    indicatorsContainer.appendChild(btn);
    btn.addEventListener('click', () => goTo(i));
  });

  const indicators = Array.from(indicatorsContainer.children);

  function update() {
    track.style.transform = `translateX(-${index * 100}%)`;
    indicators.forEach((b, i) => b.toggleAttribute('aria-current', i === index));
  }

  function goTo(i) {
    index = (i + slides.length) % slides.length;
    update();
    resetTimer();
  }

  function next() { goTo(index + 1); }
  function prev() { goTo(index - 1); }

  // autoplay
  function startTimer() {
    if (timer) clearInterval(timer);
    timer = setInterval(next, autoplayInterval);
    isPlaying = true;
  }
  function stopTimer() {
    if (timer) clearInterval(timer);
    timer = null;
    isPlaying = false;
  }
  function resetTimer() {
    stopTimer();
    startTimer();
  }

  // controls
  nextBtn.addEventListener('click', next);
  prevBtn.addEventListener('click', prev);

  // pause on hover and focus
  carousel.addEventListener('mouseenter', stopTimer);
  carousel.addEventListener('mouseleave', startTimer);
  carousel.addEventListener('focusin', stopTimer);
  carousel.addEventListener('focusout', startTimer);

  // keyboard navigation
  document.addEventListener('keydown', (e) => {
    if (!carousel.contains(document.activeElement) && !carousel.matches(':hover')) {
      /* still allow global left/right */
    }
    if (e.key === 'ArrowRight') next();
    if (e.key === 'ArrowLeft') prev();
  });

  // touch / swipe support (simple)
  let startX = 0;
  carousel.addEventListener('touchstart', (e) => { startX = e.touches[0].clientX; }, {passive:true});
  carousel.addEventListener('touchend', (e) => {
    const dx = (e.changedTouches[0].clientX - startX);
    if (Math.abs(dx) > 40) dx > 0 ? prev() : next();
  });

  // init
  update();
  // Respect reduced motion preference
  const reduce = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
  if (!reduce) startTimer();

  // Hook into date change and initial load
  document.addEventListener('DOMContentLoaded', () => {
    const dateInput = document.getElementById('calendar-date');
    const today = new Date().toISOString().split('T')[0];

    // If date input exists, ensure it has a value
    if (dateInput && !dateInput.value) dateInput.value = today;

    // initial load
    updateLiveCounter(dateInput ? dateInput.value : today);

    // when calendar date changes, update counter
    if (dateInput) {
      dateInput.addEventListener('change', (e) => {
        updateLiveCounter(e.target.value);
      });
    }

    // poll in background every POLL_MS to keep counter fresh
    setInterval(() => {
      const dateNow = dateInput ? dateInput.value : new Date().toISOString().split('T')[0];
      updateLiveCounter(dateNow);
    }, POLL_MS);
  });

  // expose for debugging if needed
  window.updateLiveCounter = updateLiveCounter;
})();
</script>
<script>
(function redirectToGoogleReviewAfterConfirmation() {
  try {
    // your Google Review link (exact as in your page)
    const GOOGLE_REVIEW_URL = 'https://g.page/r/Cf-7qdOBhUw6EAI/review';

    const modal = document.getElementById('confirmation-modal');
    if (!modal) return;

    const triggerRedirect = () => {
      // wait 2 seconds while user sees the modal, then redirect
      setTimeout(() => {
        // navigate current tab to Google review page
        window.location.href = GOOGLE_REVIEW_URL;

        // If you'd prefer to open in a new tab instead, comment the line above
        // and uncomment the line below:
        // window.open(GOOGLE_REVIEW_URL, '_blank');
      }, 2000);
    };

    // If modal already visible on load -> start timer immediately
    if (!modal.classList.contains('hidden')) {
      triggerRedirect();
      return;
    }

    // Otherwise observe the modal's class attribute and trigger when it becomes visible
    const obs = new MutationObserver((mutations, observer) => {
      if (!modal.classList.contains('hidden')) {
        triggerRedirect();
        observer.disconnect();
      }
    });
    obs.observe(modal, { attributes: true, attributeFilter: ['class'] });

  } catch (err) {
    console.error('redirectToGoogleReviewAfterConfirmation error:', err);
  }
})();
</script>
<script src="./js/testimonials.js"></script>


</body>
</html>
