<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="icon" href="images/fevicon/favicon.ico" type="image/x-icon">

  <!-- PNG favicons -->
  <link rel="icon" type="image/png" sizes="16x16" href="images/fevicon/favicon-16x16.png">
  <link rel="icon" type="image/png" sizes="32x32" href="images/fevicon/favicon-32x32.png">

  <!-- Android Chrome -->
  <link rel="icon" type="image/png" sizes="192x192" href="images/fevicon/android-chrome-192x192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="images/fevicon/android-chrome-512x512.png">

  <!-- Apple Touch Icon -->
  <link rel="apple-touch-icon" sizes="180x180" href="images/fevicon/apple-touch-icon.png">

  <!-- Manifest for PWA -->
  <link rel="manifest" href="images/fevicon/site.webmanifest">
  <link rel="manifest" href="/manifest.json">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="0" />

<meta name="theme-color" content="#4a148c">

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kanha Library Seat Booking - best library in kota</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="./index.css?v=1.3.5">
  <link rel="stylesheet" href="./css/offer.css?v=1.0.0">
  <link rel="stylesheet" href="./css/testimonials.css?v=1.0.2">
  
  

  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-MS3QJRDZ7C"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-MS3QJRDZ7C');
</script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9442859388560602"
     crossorigin="anonymous"></script>
</head>
<body>
<!-- ENHANCED ANIMATED OFFER POPUP (place right after <header>) -->

<div id="offers-modal" role="dialog" aria-modal="true" aria-label="Current offers" aria-hidden="true">
  <div class="card floating" role="document" aria-labelledby="offers-title">
    <button class="close-offers" id="closeOffersBtn" aria-label="Close offers">âœ•</button>

    <div class="offer-header">
      <h3 id="offers-title"><span class="offer-emoji">ğŸ”¥</span> Kanha Library â€” Exclusive Offers</h3>
    </div>

    <div class="offers-grid" aria-live="polite">
     
      <div class="offer">ğŸ’¸ Book 4 months â†’ â‚¹400 OFF</div>
      <div class="offer">ğŸŒŸ Book 6 months â†’ â‚¹800 OFF</div>
      <div class="offer">ğŸ† Book 12 months â†’ â‚¹2400 OFF</div>
       <div class="offer">ğŸ Referral â€” â‚¹100 OFF for
        <br> both(Invite a friend)</div>
    </div>

    <div class="divider" role="separator" aria-hidden="true"></div>

    <button class="book-seat-btn pulse" id="bookSeatBtn" onclick="location.href='booking.html'">Book Seat</button>
  </div>
</div>



 

  <header>
    <div class="logo-title">
    <img src="images/logo.jpg" alt="Kanha Library Logo" class="logo">
    <h2>Kanha Library</h2>
    </div>
    <nav>
      <span id="user-section">
      <a href="./login.html" id="login-link">Login</a>
      </span>
      <a href="./booking.html">Book Seat</a>
      <a href="#home">Home</a>
      <a href="#about">About</a>
      <a href="#contact">Contact</a>
      <a href="./policies.html">Policies</a>
      <a href="./admin.html">Admin</a>

      
    </nav>
  </header>

  <section id="my-bookings" style="display:none; padding: 20px;">
      <h2>ğŸ“š My Booked Seats</h2>
      <div id="booking-list" class="booking-list"></div>
    </section>
    
    <span class="credit-text">Website made by Chinmay Agrawal | ğŸ“7976769514</span>
    <!-- Carousel root: add role/aria for accessibility -->
    <div class="carousel" id="mainCarousel" role="region" aria-roledescription="carousel" aria-label="Library images carousel">
      <div class="carousel-track">
        <div class="carousel-slide"><img src="images/3.jpg" alt="Seating layout" ></div>
        <div class="carousel-slide"><img src="images/9.jpg" alt="Reviews" ></div>
        <div class="carousel-slide"><img src="images/4.jpg" alt="Study desks" ></div>
        <div class="carousel-slide"><img src="images/10.jpg" alt="Reviews" ></div>
        <div class="carousel-slide"><img src="images/1.jpg" alt="Study desks" ></div>
        <div class="carousel-slide"><img src="images/7.jpg" alt="Study desks" ></div>
        <!-- add more slides -->
      </div>
      <h3 id="welcome-message" class="welcome-text"></h3>



  <!-- Controls -->
  <button class="carousel-button prev" aria-label="Previous slide">&lt;</button>
  <button class="carousel-button next" aria-label="Next slide">&gt;</button>

  <!-- Indicators -->
  <div class="carousel-indicators" aria-hidden="false"></div>
</div>



    <section>
 
<div id="confirmation-modal" class="modal hidden">
  <div class="modal-content">
    
    <p id="confirmation-details"></p>
    <button id="close-modal">OK</button>
  </div>
</div>
    
  


    <h1>Welcome to Our Kanha Library</h1>
     <div style="margin-top: 40px; text-align: center;">
  <h2>ğŸ“… Check Seat Availability</h2>
  <h3>Select Date  ğŸ‘‡</h3>
  <input type="date" id="calendar-date" style="padding: 8px; font-size: 16px; margin-bottom: 15px;" />


  <div id="liveCounter" style="text-align:center; margin:20px; font-size:1.3rem; font-weight:bold; color:#f9e616;">
  ğŸ”¥ Hurry! Only <span id="seatsLeft">--</span> seats left today. Donâ€™t miss out!
</div>

<script>
async function updateLiveCounter() {
  try {
    const today = new Date().toISOString().split("T")[0]; 
    const res = await fetch(`${API_BASE}/bookings?date=${today}`);
    const bookings = await res.json();

    const booked = Array.isArray(bookings) ? bookings.length : 0;
    const total = 34; // total seats
    const left = total - booked;

    // update DOM
    document.getElementById("seatsLeft").textContent = left;

    // urgency color coding
    const counter = document.getElementById("liveCounter");
    if (left <= 5) {
      counter.style.color = "red";
      counter.style.fontSize = "1.5rem";
    } else if (left <= 10) {
      counter.style.color = "orange";
    } else {
      counter.style.color = "#4caf50";
    }
  } catch (err) {
    console.error("âš ï¸ Failed to update live counter:", err);
  }
}

// run on page load
document.addEventListener("DOMContentLoaded", () => {
  updateLiveCounter();
  // refresh every 30 sec
  setInterval(updateLiveCounter, 30000);
});
</script>



   <div class="seat-layout-container">
        <div class="fans-top">
          <div class="fan-icon">ğŸŒ€ Fan</div>
          <div class="fan-icon">ğŸŒ€ Fan</div>
        </div>
        <div class="seat-layout">
          <br>
          <div class="row" id="row3"></div>
          <div class="row" id="row2"></div>
          <br>
          <div class="row" id="row1"></div>
        </div>
        <div class="fan-bottom">
          <div class="fan-icon">ğŸŒ€ Fan</div>
          <div class="fan-icon">ğŸŒ€ Fan</div>
          <div class="fan-icon">ğŸŒ€ Fan</div>
        </div>
      </div>
  <div class="legend-container">
  <div class="legend-item legend-full-booked">â˜€ï¸Fully Booked</div>
  <div class="legend-item legend-am-booked">ğŸŒ…Morning Booked</div>
  <div class="legend-item legend-pm-booked">ğŸŒƒEvening Booked</div>
  <div class="legend-item legend-available">Available</div>
</div>

    <button class="book-now-btn" type="button">Book Seat</button>
<br><br>
    <button id="installBtn" style="display: none;" class="install-app-btn">
  <img src="icon-192.png" alt="App Icon" class="install-icon">
  Download KanhaLibrary App
</button>

</section>


  <!-- TESTIMONIAL -->
  
  <section class="testimonial-container" id="testimonials">
    <h2 class="section-title">What Our Clients Say</h2>
    <div class="slider-wrapper">
      <div class="testimonial-slider">
        <div class="testimonial-card">
          <img src="./images/reviews/1.png" alt="Client Photo" class="testimonial-image">
          <p class="testimonial-quote">"Best library in kota for study and very silent library in kota. Best wifi connection,air conditioned room, water facility is also available. Best motivation frames to get motivate for our preparation and on every desk two charging ports and a led light is attached with wider desk area"</p>
          <h3 class="testimonial-name">Aditya Jaat</h3>
          <div class="testimonial-rating">â˜…â˜…â˜…â˜…â˜…</div>
        </div>
        
        
        <div class="testimonial-card">
          <img src="./images/reviews/2.png" alt="Client Photo" class="testimonial-image">
          <p class="testimonial-quote">"A Perfect Place for Learning and Peace! .I absolutely love this library! Itâ€™s a quiet, well-organized, and resourceful place that truly supports learning and personal growth.The seating is comfortable, the environment is peaceful, and thereâ€™s just something motivating about being surrounded by knowledge.Highly recommended ğŸ“šâœ¨"</p>
          <h3 class="testimonial-name">Riyanshi Rajawat</h3>
          <div class="testimonial-rating">â˜…â˜…â˜…â˜…â˜…</div>
        </div>
        <div class="testimonial-card">
          <img src="./images/reviews/3.png" alt="Client Photo" class="testimonial-image">
          <p class="testimonial-quote">"Best library I have ever been to , Pride of Kota."</p>
          <h3 class="testimonial-name">Ashish Raj</h3>
          <div class="testimonial-rating">â˜…â˜…â˜…â˜…â˜…</div>
        </div>
        <div class="testimonial-card">
          <img src="./images/reviews/4.png" alt="Client Photo" class="testimonial-image">
          <p class="testimonial-quote">"Very Nice Experience. It's Study environment helps me a lot. It's easy to concentrate. And the owner's nature is also very good ğŸ‘ğŸ‘. "</p>
          <h3 class="testimonial-name">Kunal Mehra</h3>
          <div class="testimonial-rating">â˜…â˜…â˜…â˜…â˜…</div>
        </div>
        <div class="testimonial-card">
          <img src="./images/reviews/5.png" alt="Client Photo" class="testimonial-image">
          <p class="testimonial-quote">"A great place for study and good ambience, I should say good lighting and no interruptions and noise helped my concentration."</p>
          <h3 class="testimonial-name">Mahesh Soni</h3>
          <div class="testimonial-rating">â˜…â˜…â˜…â˜…â˜…</div>
        </div>
        
        
      </div>
    </div><br>
    <script type="text/javascript" src="https://grwapi.net/widget.min.js" async></script>
<div class="review-widget_net" data-uuid="c43e6766-44f0-44b2-988f-cef27d47875b" data-template="10" data-lang="en" data-theme="dark">Unable to load widget</div>
  </section>
  
<section>


 <div class="owner-card">
   <div class="owner-image"></div>
   <div class="owner-info">
     <h3>Mr. Brij Kishor Agrawal</h3>
     <p>Founder & Owner of Kanha Library. With years of dedication and commitment, he has built a peaceful and student-friendly study environment in the heart of Kota.</p>
   </div>
 </div>

  <div class="son-card">
   <div class="son-image"></div>
   <div class="owner-info">
     <h3>Mr. Chinmay Agrawal</h3>
     <p> Carrying forward my fatherâ€™s vision, I am proud to help manage Kanha Library, ensuring it remains a peaceful, inspiring space for students and readers. With a blend of tradition and modern ideas, Iâ€™m working to make it the best library in Kota for focused learning and growth..</p>
   </div>
 </div>
</section>

  
  <section id="about">
  <p>
  <h3>ğŸ•’ Library Timings & Charges</h3>
  <ul style="list-style: none; padding-left: 0; font-size: 1.1rem;">
    <li><strong>Morning Shift:</strong> 7:00 AM - 2:00 PM â€” <span style="color: #cec002;">â‚¹600</span></li>
    <li><strong>Evening Shift:</strong> 2:00 PM - 10:00 PM â€” <span style="color: #cec002;">â‚¹600</span></li>
    <li><strong>Full Day:</strong> 7:00 AM - 10:00 PM â€” <span style="color: #cec002;">â‚¹800</span></li>
  </ul>
  </p>
<br>
  <h2>About Us</h2>
  <p>We offer a peaceful self-study library environment with 34 seats available. Perfect for students, exam preparation, or quiet work.</p>
  <p>We aim to provide a peaceful and accessible study environment for all students and self-learners. With simple seat booking, secure online payments, and instant confirmations, your library experience is now smoother than ever.</p>
</section>
<section id="contact" style="padding: 3rem; background: linear-gradient(to right, #f5f7fa, #c3cfe2); border-radius: 20px; max-width: 1000px; margin: auto; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);">
  <h2 style="text-align: center; font-size: 2rem; color: #333; margin-bottom: 2rem;">ğŸ“ Contact Us</h2>

  <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 1.5rem;">
    <img src="https://img.icons8.com/ios-filled/30/000000/phone.png" alt="Phone Icon" style="width: 24px;">
    <a href="tel:+917976769514" style="font-size: 1.1rem; color: #000; text-decoration: none;">+91 7976769514</a>
    <a href="https://wa.me/917976769514" target="_blank">
      <img src="https://img.icons8.com/color/30/000000/whatsapp--v1.png" alt="WhatsApp Icon">
    </a>
  </div>

  <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 1.5rem;">
    <img src="https://img.icons8.com/ios-filled/30/000000/phone.png" alt="Phone Icon" style="width: 24px;">
    <a href="tel:+91" style="font-size: 1.1rem; color: #000; text-decoration: none;">+91</a>
    <a href="https://wa.me/91" target="_blank">
      <img src="https://img.icons8.com/color/30/000000/whatsapp--v1.png" alt="WhatsApp Icon">
    </a>
  </div>

  <div style="display: flex; align-items: center; gap: 10px;">
    <img src="https://img.icons8.com/ios-glyphs/30/000000/new-post.png" alt="Email Icon" style="width: 24px;">
    <a href="mailto:thechinmayagrawal@gmail.com" style="font-size: 1.1rem; color: #000; text-decoration: none;">thechinmayagrawal@gmail.com</a>
  </div>
</section>
<section style="text-align:center; padding: 20px;">
  <h3>ğŸ“ Our Location</h3>
  
  <div style="position: relative; width: 100%; max-width: 600px; margin: 0 auto; padding-top: 56.25%;">
    <iframe
      src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d907.5630559108914!2d75.88883464410213!3d25.17316652253965!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x396f9b7b1da4bf35%3A0x3a4c8581d3a9bbff!2sKanha%20Library!5e0!3m2!1sen!2sin!4v1752380422217!5m2!1sen!2sin"
      style="border:0; position: absolute; top: 0; left: 0; width: 100%; height: 100%;"
      allowfullscreen
      loading="eager"
      referrerpolicy="no-referrer-when-downgrade">
    </iframe>
  </div>
</section>
<script defer async src='https://cdn.trustindex.io/loader-cert.js?500a16b50c895583bc964b0462d'></script>

  <footer>
  <p>&copy; 2025 Kanha Library. All rights reserved.</p>
  <p style="font-size: 0.9rem; color: #aaa;">Website made by Chinmay Agrawal</p>
</footer>


  <script>
    if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('/sw.js')
    .then(() => console.log('âœ… Service Worker Registered'))
    .catch(err => console.error('Service Worker Failed:', err));
}

    const API_BASE = 'https://kanha-backend-yfx1.onrender.com/api';

    function formatDate(dateStr) {
      const date = new Date(dateStr);
      const day = String(date.getDate()).padStart(2, "0");
      const month = String(date.getMonth() + 1).padStart(2, "0");
      const year = date.getFullYear();
      return `${day}-${month}-${year}`;
    }

    function updateUserUI() {
      const userData = localStorage.getItem("user");
      const userSection = document.getElementById("user-section");
      if (userData) {
        const user = JSON.parse(userData);
        userSection.innerHTML = `<span>ğŸ‘¤ ${user.firstName || user.email} <button onclick="logout()">Logout</button></span>`;
      } else {
        userSection.innerHTML = `<a href="./login.html" id="login-link">Login</a>`;
      }
    }

    function logout() {
      localStorage.removeItem("user");
      updateUserUI();
      location.reload();
    }

    function groupBookings(bookings) {
    if (!Array.isArray(bookings) || bookings.length === 0) return [];

    // STEP 1 â€” Normalize and sort correctly
    const normalized = bookings.map(b => ({
        ...b,
        dateObj: new Date(b.date)
    }));

    normalized.sort((a, b) => a.dateObj - b.dateObj);

    const groups = [];
    let group = null;

    for (let i = 0; i < normalized.length; i++) {
        const curr = normalized[i];
        const currTime = curr.dateObj.getTime();

        if (!group) {
            // Start first group
            group = {
                seatId: curr.seatId,
                shift: curr.shift,
                start: curr.date,
                end: curr.date
            };
            continue;
        }

        const lastEnd = new Date(group.end).getTime();
        const nextExpected = lastEnd + 86400000;

        // CASE 1 â€” SAME DAY duplicate â†’ ignore it
        if (currTime === lastEnd) {
            continue;
        }

        // CASE 2 â€” Consecutive day â†’ merge
        if (
            curr.seatId === group.seatId &&
            curr.shift === group.shift &&
            currTime === nextExpected
        ) {
            group.end = curr.date;
        }

        // CASE 3 â€” Not consecutive â†’ push previous group and start new
        else {
            groups.push(group);
            group = {
                seatId: curr.seatId,
                shift: curr.shift,
                start: curr.date,
                end: curr.date
            };
        }
    }

    if (group) groups.push(group);
    return groups;
}


    async function loadBookings() {
      const userData = localStorage.getItem("user");
      if (!userData) return;
      const user = JSON.parse(userData);

      try {
        const res = await fetch(`${API_BASE}/bookings?email=${user.email}`);
        const bookings = await res.json();
        const section = document.getElementById("my-bookings");
        const list = document.getElementById("booking-list");

        if (Array.isArray(bookings) && bookings.length > 0) {
          section.style.display = "block";
          const grouped = groupBookings(bookings);
         
          list.innerHTML = grouped.map(b => {
  const today = new Date().toISOString().split('T')[0];
  const isExtendable = true;

  return `
    <div class="booking-card">
      <p><strong>Seat:</strong> ${b.seatId}</p>
      <p><strong>From:</strong> ${formatDate(b.start)}</p>
      <p><strong>To:</strong> ${formatDate(b.end)}</p>
      <p><strong>Shift:</strong> ${b.shift.toUpperCase()}</p>
      ${isExtendable ? `<button class="extend-btn" 
        data-seat="${b.seatId}" 
        data-shift="${b.shift}" 
        data-from="${b.start}" 
        data-to="${b.end}">Extend</button>` : ''}
    </div>
  `;
}).join('');
document.querySelectorAll(".extend-btn").forEach(btn => {
  btn.addEventListener("click", async (e) => {
    const seatId = e.target.dataset.seat;
    const shift = e.target.dataset.shift;
    const fromDate = e.target.dataset.from;
    const toDate = e.target.dataset.to;

    // Check extend availability
    try {
      const res = await fetch(`${API_BASE}/extend/check?seatId=${seatId}&shift=${shift}&fromDate=${fromDate}&toDate=${toDate}&email=${user.email}`);

      const data = await res.json();

      if (!data.canExtend) {
        alert("âš ï¸ Cannot extend: seat already booked for future dates.");
        return;
      }

      // Redirect to booking page with locked parameters
      window.location.href = `booking.html?extend=1&seatId=${seatId}&shift=${shift}&fromDate=${fromDate}&toDate=${toDate}`;
    } catch (err) {
      console.error("Failed to check extension availability:", err);
      alert("Server error while checking extend eligibility.");
    }
  });
});



        }
      } catch (err) {
        console.error("Error loading bookings:", err);
      }
    }

    function renderSeatLayout() {
  const rows = [
    { id: 'row1', count: 12 },
    { id: 'row2', count: 11 },
    { id: 'row3', count: 11 },
  ];

  let seatCounter = 1;

  rows.forEach(row => {
    const container = document.getElementById(row.id);
    if (!container) return;

    // If row2 should have AC icons at ends
    if (row.id === 'row2') {
      const leftAC = document.createElement('div');
      leftAC.className = 'ac-icon';
      leftAC.textContent = 'â„ï¸ AC';
      container.appendChild(leftAC);
    }

    for (let i = 0; i < row.count; i++) {
      const div = document.createElement('div');
      div.className = 'seat-box';
      div.textContent = `${seatCounter}`;
      // IMPORTANT: add a stable data attribute and id
      div.dataset.seatid = String(seatCounter);
      div.id = `seat-${seatCounter}`;
      container.appendChild(div);
      seatCounter++;
    }

    if (row.id === 'row2') {
      const rightAC = document.createElement('div');
      rightAC.className = 'ac-icon';
      rightAC.textContent = 'â„ï¸ AC';
      container.appendChild(rightAC);
    }
  });
}

// --- Replace your loadAvailability with this ---
async function loadAvailability(date) {
  if (!date) return;
  const API_BASE = 'https://kanha-backend-yfx1.onrender.com/api';

  try {
    const response = await fetch(`${API_BASE}/bookings?date=${date}`);
    const bookings = await response.json();

    // Debug: log bookings for seat 28 specifically
    console.log('Bookings response (total):', Array.isArray(bookings) ? bookings.length : bookings);
    try {
      const seat28 = (Array.isArray(bookings) && bookings.find(b => String(b.seatId).trim() === '28'));
      console.log('Seat 28 booking records (raw):', seat28 || 'none');
    } catch (e) { /* ignore */ }

    // Build normalized map: seatIdString -> array of uppercase shifts
    const seatStatus = {};
    (Array.isArray(bookings) ? bookings : []).forEach(b => {
      const sid = String(b.seatId ?? b.seat ?? '').trim();
      if (!sid) return;
      const shift = String(b.shift ?? '').trim().toUpperCase();
      if (!seatStatus[sid]) seatStatus[sid] = new Set();
      seatStatus[sid].add(shift);
    });

    // convert sets to arrays for easier checks (optional)
    Object.keys(seatStatus).forEach(k => {
      seatStatus[k] = Array.from(seatStatus[k]);
    });

    const seats = document.querySelectorAll('.seat-box');
    seats.forEach(seat => {
      // Use the data attribute â€” far more robust than textContent
      const seatId = String(seat.dataset.seatid || seat.textContent).trim();
      const shifts = seatStatus[seatId] || [];

      let bg = "white";
      // treat "FULL" or both AM & PM as fully booked
      if (shifts.includes("FULL") || (shifts.includes("AM") && shifts.includes("PM"))) {
        bg = "red";
      } else if (shifts.includes("PM") && !shifts.includes("AM")) {
        bg = "purple";
      } else if (shifts.includes("AM") && !shifts.includes("PM")) {
        // explicit AM-only -> orange
        bg = "orange";
      } else {
        bg = "white";
      }

      seat.style.backgroundColor = bg;
      seat.style.color = (bg === "purple" || bg === "red") ? "white" : "black";
    });
  } catch (err) {
    console.error("Failed to load seat availability:", err);
  }
}


    document.addEventListener("DOMContentLoaded", () => {
      renderSeatLayout();
      // --- Safe carousel fallback (replace the old buggy snippet) ---
let currentIndex = 0;
const trackEl = document.querySelector('.carousel-track');
const slidesCount = trackEl ? trackEl.children.length : 0;

// Only run a simple autoplay if track exists and there are >1 slides
if (trackEl && slidesCount > 1) {
  const simpleInterval = setInterval(() => {
    currentIndex = (currentIndex + 1) % slidesCount;
    // use percent because slides are flex: 0 0 100%
    trackEl.style.transform = `translateX(-${currentIndex * 100}%)`;
  }, 4000);

  // Optional: stop when user focuses the track (avoid interfering with your main IIFE controls)
  trackEl.addEventListener('mouseenter', () => clearInterval(simpleInterval), { once: true });
}


      updateUserUI();
      loadBookings();


      // show confirmation or cash-submitted modal on page load if redirected with ?success=1
(function checkAndShowConfirmationOnLoad(){
  try {
    const params = new URLSearchParams(window.location.search);
    console.log('[index] checkAndShowConfirmationOnLoad params:', window.location.search);

    if (params.get('success') === '1') {
      const seatId = params.get('seatId') || '';
      const shift = params.get('shift') || '';
      const startDate = params.get('startDate') || '';
      const endDate = params.get('endDate') || '';
      const isCash = params.get('cash') === '1';

      console.log('[index] Redirect params:', { seatId, shift, startDate, endDate, isCash });

      if (isCash) {
        // Show cash-submitted modal (no confirmed booking)
        if (typeof showCashSubmittedModal === 'function') {
          showCashSubmittedModal(seatId, shift, startDate, endDate);
        } else {
          // fallback: reuse confirmation modal but change text
          showConfirmationModal(seatId, shift, startDate, endDate, { cashMode: true });
        }
      } else {
        // Show confirmed booking modal
        if (typeof showConfirmationModal === 'function') {
          showConfirmationModal(seatId, shift, startDate, endDate);
        } else {
          console.warn('showConfirmationModal not found on page');
        }
      }

      // remove query params without reloading (preserve pathname & hash)
      const cleanUrl = window.location.origin + window.location.pathname + window.location.hash;
      try {
        history.replaceState({}, document.title, cleanUrl);
      } catch (e) {
        console.warn('history.replaceState failed', e);
      }
    }
  } catch (err) {
    console.error('checkAndShowConfirmationOnLoad error', err);
  }
})();


      const bookNowBtn = document.querySelector(".book-now-btn");
      bookNowBtn.addEventListener("click", () => {
        const user = localStorage.getItem("user");
        if (!user) {
          
          window.location.href = "signup.html";
        } else {
          window.location.href = "booking.html";
        }
      });

      const welcome = document.getElementById("welcome-message");
      const userData = localStorage.getItem("user");
      if (userData) {
        const user = JSON.parse(userData);
        welcome.textContent = `Welcome, ${user.firstName || ''} ${user.lastName || ''}`.trim();
      }

      const dateInput = document.getElementById("calendar-date");

// Set today's date in YYYY-MM-DD format
const today = new Date().toISOString().split("T")[0];
dateInput.value = today;

// Load today's availability immediately
loadAvailability(today);

// Listen for date change
dateInput.addEventListener("change", (e) => {
  // Show modal if redirected from booking page
const params = new URLSearchParams(window.location.search);
if (params.get('success') === '1') {
  const seatId = params.get('seatId');
  const shift = params.get('shift');
  const startDate = params.get('startDate');
  const endDate = params.get('endDate');
  showConfirmationModal(seatId, shift, startDate, endDate);
}

  const selectedDate = e.target.value;
  loadAvailability(selectedDate);
});

    });

  function showConfirmationModal(seatId, shift, startDate, endDate) {
  const modal = document.getElementById('confirmation-modal');
  const details = document.getElementById('confirmation-details');
  const closeBtn = document.getElementById('close-modal');

  details.innerHTML = `
  <h2>âœ… Seat Booked!</h2>
    Seat <strong>${seatId}</strong> booked for <strong>${shift}</strong> shift<br>
    From <strong>${startDate}</strong> to <strong>${endDate}</strong><br>
    <strong>No need to send Screenshot of Payment</strong><br>
    Thank you for booking with us! Your seat is confirmed.
  `;

  modal.classList.remove('hidden');

  closeBtn.onclick = () => {
    modal.classList.add('hidden');
    window.location.href = 'index.html'; // ğŸ” Redirect and reload to show updated seat
  };
}
function showCashSubmittedModal(seatId = '', shift = '', startDate = '', endDate = '') {
  const modal = document.getElementById('confirmation-modal');
  const details = document.getElementById('confirmation-details');
  const closeBtn = document.getElementById('close-modal');

  details.innerHTML = `
    <h3>âœ… Request Submitted</h3>
    <p>Your cash booking request has been submitted and is pending confirmation from the library.</p>
    <p><strong>Seat:</strong> ${seatId || 'N/A'}<br>
       <strong>Shift:</strong> ${shift || 'N/A'}<br>
       <strong>From:</strong> ${startDate || 'N/A'}<br>
       <strong>To:</strong> ${endDate || 'N/A'}</p>
    
  `;

  modal.classList.remove('hidden');

  // just hide modal on close; no redirect (URL was already cleaned)
  closeBtn.onclick = () => {
    modal.classList.add('hidden');
    // optional: reload to reflect state: location.reload();
  };
}
  
  </script>
  <script>
  let deferredPrompt;

  window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault();
    deferredPrompt = e;
    const installBtn = document.getElementById('installBtn');
    installBtn.style.display = 'flex';

    installBtn.addEventListener('click', () => {
      deferredPrompt.prompt();
      deferredPrompt.userChoice.then(choiceResult => {
        if (choiceResult.outcome === 'accepted') {
          console.log('âœ… App installed');
        } else {
          console.log('âŒ User dismissed');
        }
        installBtn.style.display = 'none';
      });
    });
  });
</script>




  </div>
</div>




<script>
/*
  Live counter for index.html
  - Uses your API endpoint: /api/bookings?date=YYYY-MM-DD
  - Counts a seat as "booked" if shift === 'full' OR both 'am' and 'pm' exist for same seat
  - Works with shift values like 'am','AM','pm','PM','full','FULL'
*/

(function () {
  // Use existing API_BASE if present, otherwise fallback
  const API = (typeof API_BASE !== 'undefined') ? API_BASE : 'https://kanha-backend-yfx1.onrender.com/api';
  const TOTAL_SEATS = 34;
  const POLL_MS = 30000; // refresh every 30s

  function normalizeShift(s) {
    if (!s) return '';
    return String(s).trim().toLowerCase();
  }

  async function fetchBookingsForDate(dateStr) {
    try {
      const res = await fetch(`${API}/bookings?date=${dateStr}`);
      if (!res.ok) {
        console.warn('LiveCounter: bookings fetch failed', res.status);
        return [];
      }
      const data = await res.json();
      return Array.isArray(data) ? data : [];
    } catch (err) {
      console.error('LiveCounter fetch error:', err);
      return [];
    }
  }

  function calcBookedSeats(bookings) {
    // build map: seatId -> Set of shifts
    const map = {};
    bookings.forEach(b => {
      const sid = String(b.seatId || b.seat || '').trim();
      if (!sid) return;
      const shift = normalizeShift(b.shift);

      let normalized;
      if (shift.includes('full')) normalized = 'full';
      else if (shift.startsWith('a')) normalized = 'am';
      else if (shift.startsWith('p')) normalized = 'pm';
      else normalized = shift; // fallback

      if (!map[sid]) map[sid] = new Set();
      map[sid].add(normalized);
    });

    // count seats that are fully blocked
    let bookedCount = 0;
    for (let i = 1; i <= TOTAL_SEATS; i++) {
      const sid = String(i);
      const s = map[sid];
      if (!s) continue;
      if (s.has('full') || (s.has('am') && s.has('pm'))) bookedCount++;
    }
    return bookedCount;
  }

  async function updateLiveCounter(dateStr) {
    try {
      const dateToUse = dateStr || (document.getElementById('calendar-date')?.value)
                        || new Date().toISOString().split('T')[0];
      if (!dateToUse) return;

      const bookings = await fetchBookingsForDate(dateToUse);
      const booked = calcBookedSeats(bookings);
      const left = Math.max(0, TOTAL_SEATS - booked);

      const counter = document.getElementById('liveCounter');
      if (!counter) return;

      const seatsLeftSpan = counter.querySelector('#seatsLeft');
      if (seatsLeftSpan) seatsLeftSpan.textContent = left;
      else counter.innerHTML = `ğŸ”¥ Hurry! Only <span id="seatsLeft">${left}</span> seats left today. Donâ€™t miss out!`;

      // colours / emphasis
      if (left <= 3) {
        counter.style.color = 'yellow';
        counter.style.fontWeight = '600';
      } else if (left <= 8) {
        counter.style.color = 'yellow';
        counter.style.fontWeight = '600';
      } else {
        counter.style.color = 'Yellow'; // greenish
        counter.style.fontWeight = '600';
      }

      // optional: update console (useful while testing)
      // console.log(`[LiveCounter] ${dateToUse} â€” booked ${booked}, left ${left}`);
    } catch (err) {
      console.error('updateLiveCounter error:', err);
    }
  }

  const carousel = document.getElementById('mainCarousel');
  const track = carousel.querySelector('.carousel-track');
  const slides = Array.from(track.children);
  const prevBtn = carousel.querySelector('.carousel-button.prev');
  const nextBtn = carousel.querySelector('.carousel-button.next');
  const indicatorsContainer = carousel.querySelector('.carousel-indicators');

  let index = 0;
  let autoplayInterval = 4000;
  let timer = null;
  let isPlaying = true;

  // build indicators
  slides.forEach((_, i) => {
    const btn = document.createElement('button');
    btn.type = 'button';
    btn.setAttribute('aria-label', `Go to slide ${i+1}`);
    if (i === 0) btn.setAttribute('aria-current','true');
    indicatorsContainer.appendChild(btn);
    btn.addEventListener('click', () => goTo(i));
  });

  const indicators = Array.from(indicatorsContainer.children);

  function update() {
    track.style.transform = `translateX(-${index * 100}%)`;
    indicators.forEach((b, i) => b.toggleAttribute('aria-current', i === index));
  }

  function goTo(i) {
    index = (i + slides.length) % slides.length;
    update();
    resetTimer();
  }

  function next() { goTo(index + 1); }
  function prev() { goTo(index - 1); }

  // autoplay
  function startTimer() {
    if (timer) clearInterval(timer);
    timer = setInterval(next, autoplayInterval);
    isPlaying = true;
  }
  function stopTimer() {
    if (timer) clearInterval(timer);
    timer = null;
    isPlaying = false;
  }
  function resetTimer() {
    stopTimer();
    startTimer();
  }

  // controls
  nextBtn.addEventListener('click', next);
  prevBtn.addEventListener('click', prev);

  // pause on hover and focus
  carousel.addEventListener('mouseenter', stopTimer);
  carousel.addEventListener('mouseleave', startTimer);
  carousel.addEventListener('focusin', stopTimer);
  carousel.addEventListener('focusout', startTimer);

  // keyboard navigation
  document.addEventListener('keydown', (e) => {
    if (!carousel.contains(document.activeElement) && !carousel.matches(':hover')) {
      /* still allow global left/right */
    }
    if (e.key === 'ArrowRight') next();
    if (e.key === 'ArrowLeft') prev();
  });

  // touch / swipe support (simple)
  let startX = 0;
  carousel.addEventListener('touchstart', (e) => { startX = e.touches[0].clientX; }, {passive:true});
  carousel.addEventListener('touchend', (e) => {
    const dx = (e.changedTouches[0].clientX - startX);
    if (Math.abs(dx) > 40) dx > 0 ? prev() : next();
  });

  // init
  update();
  // Respect reduced motion preference
  const reduce = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
  if (!reduce) startTimer();

  // Hook into date change and initial load
  document.addEventListener('DOMContentLoaded', () => {
    const dateInput = document.getElementById('calendar-date');
    const today = new Date().toISOString().split('T')[0];

    // If date input exists, ensure it has a value
    if (dateInput && !dateInput.value) dateInput.value = today;

    // initial load
    updateLiveCounter(dateInput ? dateInput.value : today);

    // when calendar date changes, update counter
    if (dateInput) {
      dateInput.addEventListener('change', (e) => {
        updateLiveCounter(e.target.value);
      });
    }

    // poll in background every POLL_MS to keep counter fresh
    setInterval(() => {
      const dateNow = dateInput ? dateInput.value : new Date().toISOString().split('T')[0];
      updateLiveCounter(dateNow);
    }, POLL_MS);
  });

  // expose for debugging if needed
  window.updateLiveCounter = updateLiveCounter;
})();
</script>

<script src="./js/testimonials.js?v=1.0.2"></script>
<script src="./js/offer.js?v=1.0.0"></script>


</body>
</html>
